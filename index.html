<!doctype html>
<html>
<head>
	<meta charset="utf-8">

		<style type="text/css">
			#map{ /* la carte DOIT avoir une hauteur sinon elle n'apparaît pas */
				height:400px;
				width: 100%;
			}
		</style>
	<link href="css/style.css" rel="stylesheet" type="text/css"/>
	<link href="css/bootstrap/bootstrap.css" rel="stylesheet" />
<title>Montili Avis</title>
</head>

<body class="container">
	
	<header class="row">
		<div class="col-lg-4">
			<img src="img/logo_montiliAvis.png" alt="logo montili avis"/> 
		</div>
		<div class="col-lg-2">
			
		</div>
		<div class="col-lg-6">
			
		</div>
	</header>
	
	<main class="row">
		<div class="col-lg-6" id="map"></div>
		<div class="col-lg-6" id="list">
			<h3>Liste restaurant</h3>
		</div>
	</main>
	
	<footer class="row">
	
	</footer>
	<script src="js/jquery.js" type="text/javascript"></script>
	<script src="js/restaurants.js" type="text/javascript"></script>
	<script src="https://maps.google.com/maps/api/js?key=AIzaSyByrNSyEIF-ix_iIq-ogoJCGqSIzLX-qJY" type="text/javascript"></script>
	<script type="text/javascript">
		
		// On initialise la latitude et la longitude de Montélimar (centre de la carte)
		var markerMontelimar = null;
		var map = null;
		var yourPos = null;
		var montelimar = {lat: 44.557939, lng: 4.750318};
		
	function initMap() {
		// Créer l'objet "map" et l'insèrer dans l'élément HTML qui a l'ID "map"
		map = new google.maps.Map(document.getElementById("map"), {
			// Nous plaçons le centre de la carte avec les coordonnées ci-dessus
			center: new google.maps.LatLng(montelimar), 
			// Nous définissons le zoom par défaut
			zoom: 11, 
			// Nous définissons le type de carte (ici carte routière)
			mapTypeId: google.maps.MapTypeId.ROADMAP, 
			// Nous activons les options de contrôle de la carte (plan, satellite...)
			mapTypeControl: true,
			// Nous désactivons la roulette de souris
			scrollwheel: false, 
			mapTypeControlOptions: {
				// Cette option sert à définir comment les options se placent
				style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR 
			},
			// Activation des options de navigation dans la carte (zoom...)
			navigationControl: true, 
			navigationControlOptions: {
				// Comment ces options doivent-elles s'afficher
				style: google.maps.NavigationControlStyle.ZOOM_PAN 
			}
			
		});
		
		infoWindow = new google.maps.InfoWindow;

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            yourPos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            infoWindow.setPosition(yourPos);
            infoWindow.setContent('Vous etes ici.');
            infoWindow.open(map);
            map.setCenter(yourPos);
			 
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
      }

      function handleLocationError(browserHasGeolocation, infoWindow, yourPos) {
        infoWindow.setPosition(yourPos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
      }
	  var markerMontelimar = new google.maps.Marker({position: montelimar, map: map});
	  var markerYourPos = new google.maps.Marker({position: yourPos, map: map});
	  
	function initRestaurantsJSON(callback) {
	   var request = new XMLHttpRequest();
		request.onreadystatechange = function() {
			if (this.readyState == XMLHttpRequest.DONE && this.status == 200) {
				var restaurantsResponses = JSON.parse(this.responseText);
				for(var restaurants of restaurantsResponses){
					
					restaurant = new Restaurants(restaurants.idRestaurant, restaurants.name, restaurants.address, restaurants.description, restaurants.lat, restaurants.lng, restaurants.ratings);
					
					restaurant.displayRestaurants(restaurant);
				// appel callback car appel terminé
				callback();
				}
				
				
			}
		};
		request.open("GET", "json/restaurants.json");
		request.send();
		
	}

		window.onload = function(){
			// Fonction d'initialisation qui s'exécute lorsque le DOM est chargé
			initMap();
			initRestaurantsJSON(function() {
				const nodeList = document.getElementsByClassName('article');
				
				for (let x = 0; x < nodeList.length; x++) {
					nodeList[x].addEventListener('click', function(event) {
						console.log('click sur article : ' + x);
						let ul = document.getElementById('ul-'+x);
						let les_li = ul.querySelectorAll('li');
						for(let y = 0; les_li.length > y ; y++) {
							let li = les_li[y];
							li.classList.remove('listElementNone');
						} 
					})
					nodeList[x].addEventListener('mouseout', function(event){
						let ul = document.getElementById('ul-'+x);
						let les_li = ul.querySelectorAll('li');
						for(let y = 0; les_li.length > y ; y++) {
							let li = les_li[y];
							li.classList.add('listElementNone');
						} 
					})
				}
			});
				
		};
	</script>
</body>
</html>
